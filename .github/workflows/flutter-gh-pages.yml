name: Deploy Flutter web app to Github Pages

on:
  push:
    branches: [ main ]

  # Allows to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2 # Only works with v2
      - name: Decode base64 secrets # Source: https://stackoverflow.com/a/67998780/12518132
        run: echo $DOTENV_TEST | base64 -d > .env
        env:
          DOTENV_TEST: ${{ secrets.DOTENV_TEST }}
      - uses: subosito/flutter-action@v1
      - uses: bluefireteam/flutter-gh-pages@v7
        with:
          baseHref: /dotenv_gh_pages/